box: wercker/nodejs
build:
  steps:
    - script:
        name: install global npm dependencies
        code: sudo npm install -g pliers cloudflare-cli
    - script:
        name: install project npm dependencies
        code: |-
          mkdir -p $WERCKER_CACHE_DIR/wercker/npm
          npm config set cache $WERCKER_CACHE_DIR/wercker/npm
          sudo npm install --save-dev
    - script:
        name: build project using pliers
        code: pliers build
  after-steps:
    - email-notify:
        on: failed
        from: alerts@wercker.com
        to: hello@benedfit.com
        host: smtp.gmail.com:587
        username: $EMAIL_USERNAME
        password: $EMAIL_PASSWORD
deploy:
  steps:
    - script:
        name: gonfigure git
        code: |-
          git config --global user.email "pleasemailus@wercker.com"
          git config --global user.name "wercker"
          rm -rf .git
    - script:
        name: deploy to github pages
        code: |-
          cd _output
          git init
          git add .
          git commit -m "deploy commit from $WERCKER_STARTED_BY via Wercker"
          git push -f $GIT_REMOTE $GIT_BRANCH
    - script:
        name: purge cloudflare cache
        code: |-
          cfcli purgecache -k $CLOUDFLARE_TOKEN -e $EMAIL_USERNAME -d benedfit.com
  after-steps:
    - email-notify:
        from: alerts@wercker.com
        to: hello@benedfit.com
        host: smtp.gmail.com:587
        username: $EMAIL_USERNAME
        password: $EMAIL_PASSWORD
